<div flex ng-if="!loading && globalRuleSet == 'ruleset' && globalsubmenuNavItem2 == 'rules'" ng-controller="rulesController"
    layout="column" id="rulesContainer" layout-padding layout-align="start space-around">

    <div class='uil-ring-css' ng-show="loading">
        <div></div>
    </div>

    <div ng-show="!loading" layout="row" layout-align="start stretch" layout-align="center start" class="manager-ruleset-rules-top-row lateral-padding-4">
        <md-card flex>
            <md-card-content class="wazuh-column">
                <span class="md-headline">Top 24h - Rule ID</span>
                <kbn-vis specific-time-range="true" vis-id="'Wazuh-App-Manager-Ruleset-Rules-Top-24h-Rule-ID'" id="Wazuh-App-Manager-Ruleset-Rules-Top-24h-Rule-ID"></kbn-vis>
            </md-card-content>
        </md-card>
        <md-card flex>
            <md-card-content class="wazuh-column">
                <span class="md-headline">Top 24h - Groups</span>
                <kbn-vis specific-time-range="true" vis-id="'Wazuh-App-Manager-Ruleset-Rules-Top-24h-Groups'" id="Wazuh-App-Manager-Ruleset-Rules-Top-24h-Groups"></kbn-vis>
            </md-card-content>
        </md-card>
        <md-card flex>
            <md-card-content class="wazuh-column">
                <span class="md-headline">Top 24h - PCI DSS requirements</span>
                <kbn-vis specific-time-range="true" vis-id="'Wazuh-App-Manager-Ruleset-Rules-Top-24h-PCI-DSS-requirements'" id="Wazuh-App-Manager-Ruleset-Rules-Top-24h-PCI-DSS-requirements"></kbn-vis>
            </md-card-content>
        </md-card>
        <md-card flex>
            <md-card-content class="wazuh-column">
                <span class="md-headline">Top 24h - Level</span>
                <kbn-vis specific-time-range="true" vis-id="'Wazuh-App-Manager-Ruleset-Rules-Top-24h-Level'" id="Wazuh-App-Manager-Ruleset-Rules-Top-24h-Level"></kbn-vis>
            </md-card-content>
        </md-card>
    </div>

    <div ng-show="!loading" flex layout="column">
        <div id="content" layout="row" layout-align="start start" class="manager-ruleset-rules-button-bar">
            <span layout="row" class="manager-ruleset-rules-button-bar-span" flex layout-align="space-between center">
                <md-autocomplete flex
                id="Auto"
                md-input-id="autocomplete"
                md-select-on-match="true"
                md-no-cache="noCache"
                md-selected-item="filter"
                md-selected-item-change="rules.addFilter('search', filter.description)"
                md-search-text="searchTerm"
                md-items="rule in analizeRules(searchTerm)"
                md-item-text="rule.file + ' - ' + rule.description"
                md-min-length="0"
                md-no-asterisk="false"
                md-menu-class="autocomplete-custom-agents-bar"
                md-search-text-change="analizeRules(searchTerm)"
                placeholder="Search..."
                lazy-load-data="rulesAutoComplete.nextPage()"
                md-autofocus=""
                my-enter="checkEnter(searchTerm)">
                    <md-item-template>
                        <span class="item-title">
                            <strong md-highlight-text="search" md-highlight-flags="i"> {{rule.file}} - {{rule.description}} </strong>
                        </span>
                        <span class="item-metadata">
                            <span class="item-metastat" ng-if="rule.type != 'pci'"> {{rule.type}} </span>
                            <span class="item-metastat" ng-if="rule.type == 'pci'">PCI control</span>
                        </span>
                    </md-item-template>
                    <md-not-found>
                        No results matching "{{searchTerm}}" were found.
                    </md-not-found>
                </md-autocomplete>
            </span>

            <md-button flex="10" ng-class="(globalsubmenuNavItem2 == 'rules') ? 'button-active' : 'buttonBlueLightRuleset'"
                ng-click="setRulesTab('rules')" class="md-primary manager-ruleset-rules-rulbtn">
                Rules
            </md-button>
            <md-button flex="10" ng-class="(globalsubmenuNavItem2 == 'decoders') ? 'button-active' : 'buttonBlueLightRuleset'"
                ng-click="setRulesTab('decoders')" class="md-primary manager-ruleset-rules-decbtn">
                Decoders
            </md-button>
        </div>

        <md-chips readonly="true" ng-show="rules.hasFilter('level') || rules.hasFilter('search') || rules.hasFilter('file') || rules.hasFilter('group') || rules.hasFilter('pci')">
            <md-chip class="wazuh-chip" ng-click="rules.removeFilter('search', true)" ng-if="rules.hasFilter('search') && rules.getFilter('search')">
                <span class="bold">Search: {{rules.getFilter('search')}}
                    <i class="fa fa-times" aria-hidden="true"></i>
                </span>
            </md-chip>
            <md-chip class="wazuh-chip" ng-click="rules.removeFilter('file', true)" ng-if="rules.hasFilter('file')">
                <span class="bold">File: {{rules.getFilter('file')}}
                    <i class="fa fa-times" aria-hidden="true"></i>
                </span>
            </md-chip>
            <md-chip class="wazuh-chip" ng-click="rules.removeFilter('level', true)" ng-if="rules.hasFilter('level')">
                <span class="bold">Level: {{rules.getFilter('level')}}
                    <i class="fa fa-times" aria-hidden="true"></i>
                </span>
            </md-chip>
            <md-chip class="wazuh-chip" ng-click="rules.removeFilter('group', true)" ng-if="rules.hasFilter('group')">
                <span class="bold">Group: {{rules.getFilter('group')}}
                    <i class="fa fa-times" aria-hidden="true"></i>
                </span>
            </md-chip>
            <md-chip class="wazuh-chip" ng-click="rules.removeFilter('pci', true)" ng-if="rules.hasFilter('pci')">
                <span>PCI control: {{rules.getFilter('pci')}}
                    <i class="fa fa-times" aria-hidden="true"></i>
                </span>
            </md-chip>
        </md-chips>

        <wz-table-header
            layout="row" 
            data="rules" 
            keys="[
                {name:'ID',sortValue:'id',size:5},
                {name:'File',sortValue:'file',size:15},
                {name:'Description',sortValue:'description',size:35},
                {name:'Groups',size:25},
                {name:'Requirement',size:15},
                {name:'Level',sortValue:'level',size:5}
            ]">
        </wz-table-header>
        <wz-table 
            layout="column" 
            flex
            func="closeOther(rule)"
            data="rules" 
            full="'rule'"
            activeitem="activeItem"
            keys="[
                {col:'id',size:5},
                {col:'file',size:15},
                {col:'description',size:35},
                {col:'groups',size:25},
                {col:'pci',size:15},
                {col:'level',size:5}
            ]" 
            isruleset="true"
            class="no-lateral-padding">
        </wz-table>

        <md-content>
            <md-progress-linear class="md-accent" md-mode="indeterminate" ng-show="rules.busy"></md-progress-linear>
        </md-content>
    </div>
</div>
