<div ng-if="!ctrl.init && !ctrl.loading && ctrl.errorInit" class="wz-margin-top-16" layout="column"
    layout-align="start space-around">
    <div flex layout="row" layout-align="center center">
        <md-card flex="50" class="wz-md-card" flex>
            <md-card-content class="wz-text-center">
                <span class="wz-headline-title">
                    <svg class="euiIcon euiIcon--medium" focusable="false" xmlns="http://www.w3.org/2000/svg" width="16"
                        height="16" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                            d="M8.378 1.496l6.695 10.984A1 1 0 0 1 14.22 14H1.667a1 1 0 0 1-.883-1.47L6.642 1.545a1 1 0 0 1 1.736-.05zm-.853.52L1.667 13h12.552L7.525 2.016zM7.14 10.06L6.9 5.18h1.3l-.25 4.878h-.81zm.394 1.901a.61.61 0 0 1-.448-.186.606.606 0 0 1-.186-.444c0-.174.062-.323.186-.446a.614.614 0 0 1 .448-.184c.169 0 .315.06.44.182.124.122.186.27.186.448a.6.6 0 0 1-.189.446.607.607 0 0 1-.437.184z">
                        </path>
                    </svg> Error fetching agents
                </span>
                <md-divider class="wz-margin-top-10"></md-divider>
                <div layout="row" class="wz-margin-top-10 layout-align-center-center">
                    <p class="wz-text-gray">
                        {{ ctrl.errorInit || 'Internal error' }}
                    </p>
                </div>
                <div layout="row" class="wz-margin-top-10 layout-align-center-center">
                    <button class="kuiButton kuiButton--secondary height-35" ng-click="ctrl.load()">
                        <svg class="euiIcon euiIcon--medium" focusable="false" xmlns="http://www.w3.org/2000/svg"
                            width="16" height="16" viewBox="0 0 16 16">
                            <path
                                d="M11.228 2.942a.5.5 0 1 1-.538.842A5 5 0 1 0 13 8a.5.5 0 1 1 1 0 6 6 0 1 1-2.772-5.058zM14 1.5v3A1.5 1.5 0 0 1 12.5 6h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 1 1 1 0z">
                            </path>
                        </svg> Refresh
                    </button>
                </div>
            </md-card-content>
        </md-card>
    </div>
</div>

<div ng-if="!ctrl.init && !ctrl.loading && !ctrl.errorInit" class="" layout="column" layout-align="start space-around">
    <div ng-hide="wazuh_table_loading || showNoAgents">
        <div layout="column" layout-align="start">
            <div layout="row" class="wz-padding-left-8 wz-padding-right-8 wz-margin-top-10"
                layout-align="start stretch">
                <md-card flex="50" class="wz-md-card">
                    <md-card-content>
                        <span class="wz-headline-title">Status</span>
                        <md-divider class="wz-margin-top-10"></md-divider>
                        <div layout="row">
                            <div flex layout="column">
                                <div layout="row" class="wz-padding-top-10">
                                    <p flex="50">Active</p>
                                    <p class="wz-text-right color-grey">{{ctrl.agentsCountActive}}</p>
                                </div>
                                <div layout="row" class="wz-padding-top-10">
                                    <p flex="50">Disconnected</p>
                                    <p class="wz-text-right color-grey">{{ctrl.agentsCountDisconnected}}</p>
                                </div>
                            </div>
                            <div flex layout="column">
                                <div layout="row" class="wz-padding-top-10">
                                    <p flex="50">Never connected</p>
                                    <p class="wz-text-right color-grey">{{ctrl.agentsCountNeverConnected}}</p>
                                </div>
                                <div layout="row" class="wz-padding-top-10">
                                    <p flex="50">Agents coverage</p>
                                    <p class="wz-text-right color-grey">{{(ctrl.agentsCoverity | number:2)}}%</p>
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                </md-card>
                <md-card flex="50" class="wz-md-card">
                    <md-card-content>
                        <span class="wz-headline-title">Top</span>
                        <md-divider class="wz-margin-top-10"></md-divider>
                        <div layout="row" class="wz-padding-top-10">
                            <p flex="35" class="manager-status-subtitle">Last registered agent</p>
                            <p ng-if="ctrl.lastAgent.id !== '000'" class="wz-text-right wz-text-link"
                                tooltip="Click to open this agent" tooltip-placement="right"
                                ng-click="ctrl.showAgent(ctrl.lastAgent)">{{ctrl.lastAgent.name}}</p>
                            <p ng-if="ctrl.lastAgent.id === '000'" class="wz-text-right" tooltip-placement="right">
                                {{ctrl.lastAgent.name}}
                                (manager)</p>
                        </div>
                        <div layout="row" class="wz-padding-top-10">
                            <p flex="35" class="manager-status-subtitle">Higher activity</p>
                            <p ng-show="ctrl.mostActiveAgent.id !== '000'" class="wz-text-right wz-text-link"
                                tooltip="Click to open this agent" tooltip-placement="right"
                                ng-click="ctrl.showAgent(ctrl.mostActiveAgent)">{{ctrl.mostActiveAgent.name}}</p>
                            <p ng-show="ctrl.mostActiveAgent.id === '000'" class="wz-text-right"
                                tooltip-placement="right">{{ctrl.mostActiveAgent.name}}</p>
                        </div>
            </div>
            </md-card-content>
            </md-card>
        </div>
    </div>
    <div layout="row" class="md-padding">
        <wz-tag-filter flex path="'/agents'" query-fn="ctrl.query(q, search)" fields-model="ctrl.searchBarModel">
        </wz-tag-filter>
        <md-button class="agents-prev-btn btn btn-info" style="height: 48px;margin: 0px 0 0 8px!important;"
            ng-click="ctrl.reloadList()"><svg class="euiIcon euiIcon--medium" focusable="false"
                xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                <path
                    d="M11.228 2.942a.5.5 0 1 1-.538.842A5 5 0 1 0 13 8a.5.5 0 1 1 1 0 6 6 0 1 1-2.772-5.058zM14 1.5v3A1.5 1.5 0 0 1 12.5 6h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 1 1 1 0z">
                </path>
            </svg> Refresh</md-button>
    </div>

    <div layout="row">
        <md-card flex class="wz-md-card _md flex md-margin-h">
            <md-card-content>
                <div layout="row">
                    <wz-table custom-columns="true" flex path="'/agents'"
                        keys="[{value: 'id', width: '75px'},'name','ip','status','group','os.name','os.version','version', 'dateAdd', 'lastKeepAlive']"
                        allow-click="true" row-sizes="[17,15,13]"></wz-table>
                </div>
                <div layout="row" layout-align="end center">
                    <button type="button" ng-click="ctrl.downloadCsv()"
                        class="euiButtonEmpty euiButtonEmpty--primary euiButtonEmpty--small">
                        <span class="euiButtonEmpty__content">
                            <react-component name="EuiIcon" props="{type:'importAction'}" />
                            <span class="euiButtonEmpty__text">Formatted</span>
                        </span>
                    </button>
                </div>
            </md-card-content>
        </md-card>
    </div>
</div>