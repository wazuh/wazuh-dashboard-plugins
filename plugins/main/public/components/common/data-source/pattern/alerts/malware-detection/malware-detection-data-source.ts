import { tFilter } from '../../../index';
import { DATA_SOURCE_FILTER_CONTROLLED_MALWARE_DETECTION_RULE_GROUP } from '../../../../../../../common/constants';
import { AlertsDataSource } from '../alerts-data-source';
import { FILTER_OPERATOR, PatternDataSourceFilterManager } from '../../..';

const MALWARE_DETECTION_GROUP_KEY = 'rule.groups';
const MALWARE_DETECTION_GROUP_VALUES = ['rootcheck', 'virustotal', 'yara'];

export class MalwareDetectionDataSource extends AlertsDataSource {
  constructor(id: string, title: string) {
    super(id, title);
  }

  getRuleGroupsFilter() {
    return [
      PatternDataSourceFilterManager.createFilter(
        FILTER_OPERATOR.IS_ONE_OF,
        MALWARE_DETECTION_GROUP_KEY,
        MALWARE_DETECTION_GROUP_VALUES,
        this.id,
        DATA_SOURCE_FILTER_CONTROLLED_MALWARE_DETECTION_RULE_GROUP,
      ),
    ];
  }

  getFixedFilters(): tFilter[] {
    return [
      ...super.getFixedFiltersClusterManager(),
      ...this.getRuleGroupsFilter(),
      ...super.getFixedFilters(),
    ];
  }
}
